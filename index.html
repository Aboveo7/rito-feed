<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Gaming Feed</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
html,body{
  margin:0;
  background:radial-gradient(circle at top,#111 0%,#000 65%);
  color:#fff;
  font-family:Segoe UI,Arial;
  overflow-x:hidden;
}
*{box-sizing:border-box;scrollbar-width:none}
*::-webkit-scrollbar{display:none}

.root{padding:18px}
.title{font-size:18px;margin:28px 0 14px;letter-spacing:3px}

.slider{
  display:flex;
  gap:16px;
  overflow-x:auto;
  scroll-behavior:smooth;
}

.card{
  min-width:240px;
  background:#111;
  border-radius:14px;
  overflow:hidden;
  cursor:pointer;
  transition:.25s;
}
.card:hover{transform:scale(1.05)}

.thumb{width:100%;aspect-ratio:16/9;object-fit:cover}
.meta{padding:10px;font-size:13px}

.live{
  position:absolute;
  top:8px;left:8px;
  background:#ff0000;
  padding:4px 8px;
  border-radius:6px;
  font-size:11px;
}

.box{
  background:#0f0f0f;
  padding:14px;
  border-radius:14px;
  line-height:1.6;
}
</style>
</head>

<body>
<div class="root" id="app"></div>

<script>
/* ================= API PROTECTION ================= */
const k1="AIzaSy";
const k2="DWyU8Ldkg0yk";
const k3="xX-KIXi-a-59oiPNWAzxI";
const API_KEY = k1+k2+k3;

/* ================= CONFIG ================= */
const CHANNEL_ID="UCeq1rnutfneY2AUe3Fi7gTA";
const API="https://www.googleapis.com/youtube/v3";
const RSS=`https://www.youtube.com/feeds/videos.xml?channel_id=${CHANNEL_ID}`;
const app=document.getElementById("app");

/* ================= HELPERS ================= */
const openVid=id=>window.open("https://youtube.com/watch?v="+id,"_blank");
const isLong=v=>v.contentDetails.duration.match(/PT(\d+)M/) && parseInt(RegExp.$1)>=2;
const isShort=v=>v.contentDetails.duration==="PT0S";
const cache=k=>JSON.parse(localStorage.getItem(k)||"null");
const save=(k,v)=>localStorage.setItem(k,JSON.stringify(v));

function card(v,live=false){
  return `
  <div class="card" onclick="openVid('${v.id}')">
    <div style="position:relative">
      <img class="thumb" src="${v.snippet.thumbnails.high.url}">
      ${live?'<div class="live">LIVE</div>':''}
    </div>
    <div class="meta">${v.snippet.title}</div>
  </div>`;
}

/* ================= RSS CHANGE DETECTION ================= */
async function rssChanged(){
  try{
    const r=await fetch(RSS);
    const t=await r.text();
    const id=t.match(/<yt:videoId>(.*?)<\/yt:videoId>/)[1];
    const last=localStorage.getItem("last_vid");
    if(last!==id){
      localStorage.setItem("last_vid",id);
      return true;
    }
  }catch{}
  return false;
}

/* ================= SUMMARY AI ================= */
function summary(videos){
  const map={};
  videos.forEach(v=>{
    const words=v.snippet.title.toLowerCase().split(" ");
    words.forEach(w=>{
      if(w.length>4){
        map[w]=(map[w]||0)+parseInt(v.statistics.viewCount||0);
      }
    });
  });
  const best=Object.entries(map).sort((a,b)=>b[1]-a[1])[0];
  return best
    ? `Content mainly performs best around "${best[0]}" based gameplay. The creator focuses on consistent themes with strong audience interest and recognizable style.`
    : `The channel shows consistent experimentation with gaming content and evolving formats.`;
}

/* ================= MAIN LOAD ================= */
async function load(force=false){
  const last=cache("page_data");
  const lastTime=localStorage.getItem("last_time");
  const changed=await rssChanged();

  if(!force && last && !changed && Date.now()-lastTime<86400000){
    render(last);
    return;
  }

  try{
    const s=await fetch(`${API}/search?part=id&channelId=${CHANNEL_ID}&type=video&maxResults=25&key=${API_KEY}`).then(r=>r.json());
    const ids=s.items.map(x=>x.id.videoId).join(",");
    const v=await fetch(`${API}/videos?part=snippet,statistics,contentDetails,liveStreamingDetails&id=${ids}&key=${API_KEY}`).then(r=>r.json());

    save("page_data",v.items);
    localStorage.setItem("last_time",Date.now());
    render(v.items);
  }catch{
    if(last) render(last);
  }
}

/* ================= RENDER ================= */
function render(items){
  const lives=items.filter(v=>v.liveStreamingDetails && !isShort(v));
  const videos=items.filter(v=>isLong(v) && !v.liveStreamingDetails);
  const most=[...videos].sort((a,b)=>b.statistics.viewCount-a.statistics.viewCount)[0];
  const rest=videos.filter(v=>v!==most).sort(()=>0.5-Math.random());

  /* weekly recommendation */
  const wk="week_"+new Date().getWeek();
  let rec=cache(wk);
  if(!rec){
    rec=videos[Math.floor(Math.random()*videos.length)];
    save(wk,rec);
  }

  app.innerHTML=`
  <div class="title">LIVE STREAMS</div>
  <div class="slider">${lives.length?lives.map(v=>card(v,true)).join(""):""}</div>

  <div class="title">WEEKLY RECOMMENDATION</div>
  <div class="slider">${rec?card(rec):""}</div>

  <div class="title">VIDEOS</div>
  <div class="slider">${[most,...rest].map(v=>card(v)).join("")}</div>

  <div class="title">SUMMARY</div>
  <div class="box">${summary(videos)}</div>`;
}

Date.prototype.getWeek=function(){
  const d=new Date(Date.UTC(this.getFullYear(),this.getMonth(),this.getDate()));
  d.setUTCDate(d.getUTCDate()+4-(d.getUTCDay()||7));
  const y=new Date(Date.UTC(d.getUTCFullYear(),0,1));
  return Math.ceil((((d-y)/86400000)+1)/7);
};

/* ================= START ================= */
load();
setInterval(()=>load(false),3600000);
</script>
</body>
</html>
