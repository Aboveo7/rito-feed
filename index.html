<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Gaming Feed</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
html,body{
  margin:0;
  background:radial-gradient(circle at top,#111 0%,#000 65%);
  color:#fff;
  font-family:Segoe UI,Arial;
  overflow-x:hidden;
  min-height:100vh;
}

/* HIDE SCROLLBAR BUT KEEP SCROLL */
*{
  box-sizing:border-box;
  scrollbar-width:none;
}
*::-webkit-scrollbar{width:0;height:0}

.container{padding:18px}
.title{
  margin:26px 0 12px;
  letter-spacing:3px;
  font-size:17px;
}

.slider{
  display:flex;
  gap:16px;
  overflow-x:auto;
  scroll-behavior:smooth;
}

.card{
  min-width:240px;
  background:#111;
  border-radius:14px;
  overflow:hidden;
  cursor:pointer;
  transition:.25s;
}
.card:hover{transform:scale(1.05)}

.thumb{
  width:100%;
  aspect-ratio:16/9;
  object-fit:cover;
}

.meta{padding:10px;font-size:13px}

.live{
  position:absolute;
  top:8px;left:8px;
  background:#e60000;
  padding:4px 8px;
  border-radius:6px;
  font-size:11px;
}

.box{
  background:#0f0f0f;
  padding:14px;
  border-radius:14px;
  line-height:1.6;
  opacity:.95;
}
</style>
</head>

<body>
<div class="container" id="app"></div>

<script>
/* ================= CONFIG ================= */

const API_KEY = "AIzaSyDWyU8Ldkg0ykxX-KIXi-a-59oiPNWAzxI"; // â† PUT API HERE
const CHANNEL_ID = "UCeq1rnutfneY2AUe3Fi7gTA";
const API = "https://www.googleapis.com/youtube/v3";

/* ================= CACHE KEYS ================= */

const CACHE_DATA = "yt_cached_data";
const CACHE_TIME = "yt_cached_time";
const WEEK_REC = "yt_weekly_rec";
const CHECK_TIME = 24 * 60 * 60 * 1000;

/* ================= HELPERS ================= */

const app = document.getElementById("app");

function openVideo(id){
  window.open("https://youtube.com/watch?v="+id,"_blank");
}

function isVideo(v){
  const d = v.contentDetails.duration;
  return !(d.includes("S") && !d.includes("M") && !d.includes("H")) &&
         parseDuration(d) >= 120;
}

function isShort(v){
  return parseDuration(v.contentDetails.duration) < 60;
}

function parseDuration(iso){
  let s=0;
  iso.replace(/(\d+)H/,(_,n)=>s+=n*3600);
  iso.replace(/(\d+)M/,(_,n)=>s+=n*60);
  iso.replace(/(\d+)S/,(_,n)=>s+=n);
  return s;
}

/* ================= API SAFE FETCH ================= */

async function fetchYT(url){
  try{
    const r = await fetch(url);
    if(!r.ok) throw 0;
    return await r.json();
  }catch{
    return null;
  }
}

/* ================= MAIN LOAD ================= */

async function loadData(force=false){
  const last = localStorage.getItem(CACHE_TIME);
  const cached = localStorage.getItem(CACHE_DATA);

  if(cached && !force && Date.now()-last < CHECK_TIME){
    render(JSON.parse(cached));
    return;
  }

  const search = await fetchYT(
    `${API}/search?part=id&channelId=${CHANNEL_ID}&type=video&maxResults=25&key=${API_KEY}`
  );

  if(!search){
    if(cached) render(JSON.parse(cached));
    return;
  }

  const ids = search.items.map(x=>x.id.videoId).join(",");
  const videos = await fetchYT(
    `${API}/videos?part=snippet,statistics,contentDetails,liveStreamingDetails&id=${ids}&key=${API_KEY}`
  );

  if(!videos){
    if(cached) render(JSON.parse(cached));
    return;
  }

  localStorage.setItem(CACHE_DATA,JSON.stringify(videos.items));
  localStorage.setItem(CACHE_TIME,Date.now());
  render(videos.items);
}

/* ================= RENDER ================= */

function render(items){
  app.innerHTML="";

  const lives = items.filter(v=>v.liveStreamingDetails?.actualStartTime);
  const videos = items.filter(isVideo);
  const shorts = items.filter(isShort);

  /* MOST VIEWED FIRST VIDEO */
  videos.sort((a,b)=>b.statistics.viewCount-a.statistics.viewCount);
  const firstVideo = videos[0];
  const restVideos = videos.slice(1).sort(()=>Math.random()-0.5);

  /* WEEKLY RECOMMENDATION (STABLE) */
  let recId = localStorage.getItem(WEEK_REC);
  if(!recId){
    recId = videos[Math.floor(Math.random()*videos.length)]?.id;
    localStorage.setItem(WEEK_REC,recId);
  }
  const weekly = videos.find(v=>v.id===recId);

  /* SUMMARY (AI STYLE) */
  const topicMap = {};
  videos.forEach(v=>{
    const words = v.snippet.title.toLowerCase().split(" ");
    words.forEach(w=>{
      if(w.length>4){
        topicMap[w]=(topicMap[w]||0)+parseInt(v.statistics.viewCount||0);
      }
    });
  });
  const bestTopic = Object.entries(topicMap).sort((a,b)=>b[1]-a[1])[0];

  app.innerHTML += `
    <div class="title">LIVE STREAMS</div>
    <div class="slider">
      ${(lives.length?lives:videos.slice(0,2)).map(v=>card(v,true)).join("")}
    </div>

    <div class="title">WEEKLY RECOMMENDATION</div>
    <div class="slider">${weekly?card(weekly):""}</div>

    <div class="title">VIDEOS</div>
    <div class="slider">
      ${firstVideo?card(firstVideo):""}
      ${restVideos.map(card).join("")}
    </div>

    <div class="title">SUMMARY</div>
    <div class="box">
      The channel performs best around <b>${bestTopic?bestTopic[0]:"gameplay"}</b>
      related content. Longer videos attract stronger engagement, while live
      sessions help maintain audience connection. Overall content style is
      consistent and gaming-focused.
    </div>
  `;
}

/* ================= CARD ================= */

function card(v,allowLive){
  return `
  <div class="card" onclick="openVideo('${v.id}')">
    <div style="position:relative">
      <img class="thumb" src="${v.snippet.thumbnails.high.url}">
      ${allowLive && v.liveStreamingDetails?'<div class="live">LIVE</div>':''}
    </div>
    <div class="meta">${v.snippet.title}</div>
  </div>`;
}

/* ================= START ================= */

loadData();

/* CHECK ONLY ONCE PER DAY */
setInterval(()=>loadData(false), CHECK_TIME);
</script>
</body>
</html>
