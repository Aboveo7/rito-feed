<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Rito Gaming Feed</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
html,body{
  margin:0;
  background:#000;
  color:#fff;
  font-family:Segoe UI,Arial;
  overflow:hidden;
}
*{box-sizing:border-box;scrollbar-width:none}
*::-webkit-scrollbar{display:none}

.container{padding:18px}
.title{
  margin:28px 0 14px;
  font-size:16px;
  letter-spacing:3px;
}
.slider{
  display:flex;
  gap:16px;
  overflow-x:auto;
  scroll-behavior:smooth;
}
.card{
  min-width:240px;
  background:#111;
  border-radius:14px;
  overflow:hidden;
  cursor:pointer;
  transition:.25s;
}
.card:hover{transform:scale(1.05)}
.thumb{
  width:100%;
  aspect-ratio:16/9;
  object-fit:cover;
}
.meta{padding:10px;font-size:13px}
.live{
  position:absolute;
  top:8px;left:8px;
  background:red;
  padding:4px 8px;
  border-radius:6px;
  font-size:11px;
}
.box{
  background:#0f0f0f;
  padding:14px;
  border-radius:14px;
  opacity:.9;
}
.loader{
  height:260px;
  display:flex;
  align-items:center;
  justify-content:center;
  flex-direction:column;
}
.spin{
  width:42px;height:42px;
  border:4px solid #333;
  border-top:4px solid #fff;
  border-radius:50%;
  animation:spin 1s linear infinite;
}
@keyframes spin{to{transform:rotate(360deg)}}
</style>
</head>

<body>
<div class="container" id="app">
  <div class="loader">
    <div class="spin"></div>
    <div style="margin-top:12px">Loading feed…</div>
  </div>
</div>

<script>
/* ================= CONFIG ================= */
const API_KEY = "AIzaSyDWyU8Ldkg0ykxX-KIXi-a-59oiPNWAzxI";
const CHANNEL_ID = "UCeq1rnutfneY2AUe3Fi7gTA";
const API = "https://www.googleapis.com/youtube/v3";
const DAY = 24*60*60*1000;

/* Offline fallback videos */
const FALLBACK = [
  {id:"dQw4w9WgXcQ",title:"Offline Backup Video",thumb:"https://i.ytimg.com/vi/dQw4w9WgXcQ/hqdefault.jpg",views:0,live:false,published:0}
];

const app = document.getElementById("app");

/* ================= HELPERS ================= */
function openVideo(id){
  window.open("https://youtube.com/watch?v="+id,"_blank");
}
function card(v,live=false){
  return `
  <div class="card" onclick="openVideo('${v.id}')">
    <div style="position:relative">
      <img class="thumb" src="${v.thumb}">
      ${live?'<div class="live">LIVE</div>':''}
    </div>
    <div class="meta">${v.title}</div>
  </div>`;
}
async function safeFetch(url){
  try{
    const r=await fetch(url);
    if(!r.ok) throw 0;
    return await r.json();
  }catch{return null;}
}

/* ================= LIGHT CHECK ================= */
async function lightCheck(){
  const r = await safeFetch(
    `${API}/channels?part=snippet,statistics&id=${CHANNEL_ID}&key=${API_KEY}`
  );
  if(!r) return false;

  const count = r.items[0].statistics.videoCount;
  const pub = r.items[0].snippet.publishedAt;

  const oldCount = localStorage.getItem("yt_count");
  const oldPub = localStorage.getItem("yt_pub");

  localStorage.setItem("yt_count",count);
  localStorage.setItem("yt_pub",pub);

  return count!==oldCount || pub!==oldPub;
}

/* ================= FULL FETCH ================= */
async function fullFetch(){
  const s = await safeFetch(
    `${API}/search?part=id&channelId=${CHANNEL_ID}&type=video&maxResults=20&key=${API_KEY}`
  );
  if(!s) return null;

  const ids = s.items.map(x=>x.id.videoId).join(",");
  const v = await safeFetch(
    `${API}/videos?part=snippet,statistics,liveStreamingDetails&id=${ids}&key=${API_KEY}`
  );
  if(!v) return null;

  const data = v.items.map(x=>({
    id:x.id,
    title:x.snippet.title,
    thumb:x.snippet.thumbnails.high.url,
    views:Number(x.statistics.viewCount||0),
    live:!!x.liveStreamingDetails?.actualStartTime,
    published:new Date(x.snippet.publishedAt).getTime()
  }));

  localStorage.setItem("yt_cache",JSON.stringify(data));
  localStorage.setItem("yt_full",Date.now());
  return data;
}

/* ================= RENDER ================= */
function render(videos,offline=false){
  const now=Date.now();
  const live = videos.filter(v=>v.live);
  const mostViewed=[...videos].sort((a,b)=>b.views-a.views).slice(0,6);
  const shorts = videos.filter(v=>v.title.toLowerCase().includes("#short"));
  const normal = videos.filter(v=>!v.title.toLowerCase().includes("#short"));

  /* Weekly recommendation */
  const weekKey="rec_"+Math.floor(now/(7*DAY));
  let rec=localStorage.getItem(weekKey);
  if(!rec){
    rec=videos[Math.floor(Math.random()*videos.length)].id;
    localStorage.setItem(weekKey,rec);
  }
  const recommend=videos.find(v=>v.id===rec);

  /* Weekly summary */
  const last7=videos.filter(v=>now-v.published<=7*DAY);
  const views=last7.reduce((a,b)=>a+b.views,0);
  let summary="Low activity this week.";
  if(views<=100) summary="Content showed decent performance this week.";
  else if(views<=1000) summary="Channel performed well with steady engagement.";
  else summary="Strong weekly performance driven by consistent uploads.";

  app.innerHTML=`
  ${offline?'<div class="box">Offline mode – showing cached videos</div>':''}

  <div class="title">LIVE</div>
  <div class="slider">${live.length?live.map(v=>card(v,true)).join(""):'<div class="box">No live stream</div>'}</div>

  <div class="title">MOST VIEWED</div>
  <div class="slider">${mostViewed.map(card).join("")}</div>

  <div class="title">RECOMMENDED THIS WEEK</div>
  <div class="slider">${recommend?card(recommend):''}</div>

  <div class="title">VIDEOS</div>
  <div class="slider">${normal.map(card).join("")}</div>

  <div class="title">SHORTS</div>
  <div class="slider">${shorts.map(card).join("")}</div>

  <div class="title">WEEKLY SUMMARY</div>
  <div class="box">${summary}</div>
  `;
}

/* ================= SMART INIT ================= */
async function smartInit(){
  const lastFull=Number(localStorage.getItem("yt_full")||0);
  const now=Date.now();

  if(now-lastFull<DAY){
    const changed=await lightCheck();
    if(!changed){
      const cached=JSON.parse(localStorage.getItem("yt_cache")||"[]");
      render(cached.length?cached:FALLBACK,true);
      return;
    }
  }

  const data=await fullFetch();
  if(data) render(data);
  else{
    const cached=JSON.parse(localStorage.getItem("yt_cache")||"[]");
    render(cached.length?cached:FALLBACK,true);
  }
}

smartInit();
setInterval(smartInit,6*60*60*1000); // check every 6 hours
</script>
</body>
</html>
